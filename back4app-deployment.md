# Развертывание бэкенда на Back4app Containers

## Обзор платформы

**Back4app Containers** - это Platform-as-a-Service (PaaS) решение, которое позволяет развертывать Node.js приложения с помощью Docker контейнеров.

### Преимущества Back4app:
- ✅ **Бесплатный план**: 0.25 CPU, 256 MB RAM, 100GB трафика
- ✅ Автоматическое развертывание из GitHub
- ✅ Zero Downtime deployments (развертывание без простоев)
- ✅ Мониторинг в реальном времени (CPU, RAM, логи)
- ✅ Простая интеграция с GitHub
- ✅ AI-помощник для анализа ошибок

### Сравнение с другими платформами:
- **Railway**: $5 кредитов (ограниченное время)
- **Heroku**: Нет бесплатного плана (от $5-7/месяц)
- **Back4app**: Постоянный бесплатный план

## Подготовка к развертыванию

### 1. Проверка готовности проекта

Ваш проект уже содержит необходимые файлы:
- ✅ `backend/Dockerfile` - готов
- ✅ `backend/.dockerignore` - готов
- ✅ `backend/package.json` - готов
- ✅ `backend/server.js` - настроен для использования PORT из переменных окружения

### 2. Регистрация на Back4app

1. Перейдите на [back4app.com](https://www.back4app.com)
2. Нажмите "Sign Up" и создайте бесплатный аккаунт
3. Подтвердите email адрес

### 3. Установка Back4app GitHub App

1. В панели управления Back4app найдите раздел "Containers"
2. Установите Back4app GitHub App на ваш GitHub аккаунт
3. Предоставьте доступ к репозиторию с вашим проектом

## Пошаговое развертывание

### Шаг 1: Создание нового приложения

1. В панели управления Back4app нажмите **"NEW APP"**
2. Выберите **"Containers as a Service"**
3. Выберите ваш репозиторий из списка
4. Укажите папку `backend` как корневую директорию проекта

### Шаг 2: Настройка переменных окружения

Добавьте следующие переменные окружения:

```env
# Основные настройки
NODE_ENV=production
PORT=8080

# Telegram Bot
TELEGRAM_BOT_TOKEN=ваш_токен_бота

# Frontend URL (будет обновлен после развертывания)
FRONTEND_URL=https://ваш-домен.vercel.app

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Опциональные настройки
LOG_LEVEL=info
ENABLE_CORS=true
```

### Шаг 3: Развертывание

1. Нажмите **"Create App"**
2. Дождитесь завершения процесса сборки и развертывания
3. Следите за логами в реальном времени
4. При возникновении ошибок используйте AI-помощник Back4app для анализа

### Шаг 4: Получение URL приложения

После успешного развертывания:
1. URL вашего приложения будет показан в левом верхнем углу панели управления
2. Формат: `https://ваше-приложение.back4app.io`
3. Скопируйте этот URL для дальнейшей настройки

## Настройка после развертывания

### 1. Обновление FRONTEND_URL

1. В панели управления Back4app перейдите в раздел "Environment Variables"
2. Обновите переменную `FRONTEND_URL` на актуальный URL вашего фронтенда
3. Сохраните изменения

### 2. Настройка Telegram Bot

1. Откройте чат с @BotFather в Telegram
2. Используйте команду `/setmenubutton`
3. Выберите вашего бота
4. Установите URL: `https://ваше-приложение.back4app.io`

### 3. Тестирование API

Проверьте основные эндпоинты:

```bash
# Проверка статуса
curl https://ваше-приложение.back4app.io/api/status

# Проверка Telegram webhook
curl https://ваше-приложение.back4app.io/api/telegram/webhook
```

## Мониторинг и управление

### Просмотр логов
1. В панели управления перейдите в раздел "Logs"
2. Просматривайте логи в реальном времени
3. Фильтруйте по уровню логирования

### Мониторинг ресурсов
1. Отслеживайте использование CPU и RAM
2. Контролируйте трафик
3. Настройте уведомления при превышении лимитов

### Автоматические развертывания
1. При push в основную ветку GitHub автоматически запускается новое развертывание
2. Back4app обеспечивает zero-downtime deployment
3. Откат к предыдущей версии доступен в один клик

## Масштабирование

### Бесплатный план
- 0.25 CPU
- 256 MB RAM
- 100GB трафика в месяц
- Подходит для разработки и тестирования

### Платные планы
При необходимости масштабирования:
- **Starter**: $5/месяц - 0.5 CPU, 512 MB RAM
- **Professional**: $15/месяц - 1 CPU, 1 GB RAM
- **Business**: $50/месяц - 2 CPU, 2 GB RAM

## Устранение неполадок

### Частые проблемы

1. **Ошибка сборки Docker**
   - Проверьте Dockerfile на синтаксические ошибки
   - Убедитесь, что все зависимости указаны в package.json

2. **Приложение не запускается**
   - Проверьте переменные окружения
   - Убедитесь, что PORT настроен правильно

3. **Telegram Bot не отвечает**
   - Проверьте TELEGRAM_BOT_TOKEN
   - Убедитесь, что webhook настроен правильно

### Использование AI-помощника
1. При возникновении ошибок в логах нажмите "Analyze with AI"
2. AI-помощник предложит возможные решения
3. Следуйте рекомендациям для устранения проблем

## Альтернативные варианты

Если Back4app не подходит:

1. **Render.com** - 750 часов бесплатно
2. **Fly.io** - до 3 VM бесплатно
3. **Railway** - $5 кредитов (ограниченное время)
4. **DigitalOcean App Platform** - $5/месяц

## Заключение

Back4app Containers предоставляет отличное решение для развертывания Node.js приложений с постоянным бесплатным планом. Платформа особенно подходит для:

- Разработки и тестирования
- Небольших проектов
- Изучения DevOps практик
- Быстрого прототипирования

Платформа обеспечивает простоту использования, автоматические развертывания и качественный мониторинг, что делает её отличным выбором для развертывания вашего Telegram Mini App бэкенда.