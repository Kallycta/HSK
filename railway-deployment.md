# Развертывание бэкенда на Railway

## Сравнение платформ (2024)

### Railway
- **Бесплатный план**: $5 кредитов в первый месяц (около 500 часов использования)
- **Требования**: Нужна банковская карта для верификации
- **Особенности**: 
  - Автоматическое развертывание из GitHub
  - Поддержка Docker и Nixpacks
  - Встроенные базы данных (PostgreSQL, Redis, MongoDB, MySQL)
  - Приложение останавливается при исчерпании кредитов

### Heroku
- **Бесплатный план**: ❌ Отсутствует с ноября 2022 года
- **Минимальная цена**: От $5-7/месяц за Eco dyno
- **Особенности**: Стабильная платформа, но дорогая для продакшена

### Рекомендация
**Railway** - лучший выбор для начала, так как предоставляет $5 бесплатных кредитов.

## Пошаговое развертывание на Railway

### 1. Подготовка проекта

#### Создайте Dockerfile в папке backend:
```dockerfile
# backend/Dockerfile
FROM node:18-alpine

WORKDIR /app

# Копируем package.json и package-lock.json
COPY package*.json ./

# Устанавливаем зависимости
RUN npm ci --only=production

# Копируем исходный код
COPY . .

# Открываем порт
EXPOSE 3000

# Запускаем приложение
CMD ["npm", "start"]
```

#### Обновите package.json (уже готов):
```json
{
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "engines": {
    "node": ">=16.0.0"
  }
}
```

### 2. Регистрация на Railway

1. Перейдите на [railway.app](https://railway.app)
2. Зарегистрируйтесь через GitHub
3. Подтвердите аккаунт и добавьте банковскую карту для получения $5 кредитов

### 3. Развертывание

#### Вариант 1: Через веб-интерфейс
1. Нажмите "New Project"
2. Выберите "Deploy from GitHub repo"
3. Выберите ваш репозиторий
4. Railway автоматически определит Node.js проект
5. Укажите корневую папку как `backend`

#### Вариант 2: Через Railway CLI
```bash
# Установите Railway CLI
npm install -g @railway/cli

# Войдите в аккаунт
railway login

# В папке backend
cd backend
railway init
railway up
```

### 4. Настройка переменных окружения

В панели Railway добавьте переменные:

```env
NODE_ENV=production
PORT=3000
TELEGRAM_BOT_TOKEN=ваш_токен_бота
FRONTEND_URL=https://ваш-домен.vercel.app
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX=100
```

### 5. Настройка домена

1. В Railway перейдите в Settings → Domains
2. Нажмите "Generate Domain" для получения бесплатного поддомена
3. Или добавьте свой домен

### 6. Мониторинг использования

- Следите за использованием кредитов в Dashboard
- $5 хватает примерно на месяц для небольшого приложения
- При превышении лимита приложение остановится

### 7. Обновление Telegram Bot

После развертывания обновите FRONTEND_URL в переменных окружения:

```env
FRONTEND_URL=https://ваш-домен.vercel.app
```

### 8. Альтернативы при исчерпании кредитов

Если $5 кредитов недостаточно:

1. **Render.com** - 750 часов бесплатно (с ограничениями)
2. **Fly.io** - до 3 VM бесплатно (требует карту)
3. **Koyeb** - бесплатный план с ограничениями
4. **Glitch** - 1000 часов бесплатно

## Команды для мониторинга

```bash
# Просмотр логов
railway logs

# Статус сервиса
railway status

# Подключение к базе данных (если используется)
railway connect
```

## Troubleshooting

### Приложение не запускается
1. Проверьте логи: `railway logs`
2. Убедитесь, что PORT берется из переменной окружения
3. Проверьте Dockerfile и package.json

### Превышен лимит кредитов
1. Добавьте платежную карту для продолжения
2. Или мигрируйте на другую платформу
3. Оптимизируйте использование ресурсов

### Проблемы с Telegram Bot
1. Проверьте TELEGRAM_BOT_TOKEN
2. Убедитесь, что FRONTEND_URL указывает на Vercel
3. Проверьте webhook настройки

## Следующие шаги

1. Развернуть фронтенд на Vercel
2. Обновить URL в Telegram Mini App
3. Протестировать полную функциональность
4. Настроить мониторинг и алерты